<h2>Edit Configuration</h2>
<ConfigEditor on:saveConfig="editConfig(event.config)" data={configuration}/>
<script>
  import ConfigEditor from "../../components/config-editor.html";
  import * as sapper from "../../../__sapper__/client.js";
  import $ from "jquery";

  export default {
    preload({ params, query }) {
      let { configId } = params;
      let _this = this;
      return this.fetch("http://localhost:3000/v1/config/" + configId)
        .then(r => r.json())
        .then(configuration => {
          return { configuration };
        })
        .catch(() => {
          console.error("Could not fetch confiugration");
        });
    },

    components: { ConfigEditor },

    methods: {
      editConfig(newConfig) {
        $.ajax({
          url: "http://localhost:3000/v1/config/" + newConfig.id,
          type: "PUT",
          data: {
            configuration: JSON.stringify(newConfig)
          },
          success: () => {
            this.root.fire("alert-notification", {
              header: "Sucess",
              message: "Sucessed created new configuration"
            });
            sapper.goto("/");
          }
        });
      }
    }
  };
</script>
