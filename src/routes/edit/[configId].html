<h2>Edit Configuration</h2>
<ConfigEditor on:saveConfig="editConfig(event.config)" data={configuration}/>
<script>
  import ConfigEditor from "../../components/config-editor.html";
  import * as sapper from "../../../__sapper__/client.js";
  import $ from "jquery";
  import AjaxService from "../../services/ajax";

  export default {
    preload({ params, query }) {
      let { configId } = params;
      let _this = this;
      return AjaxService.get({
        url: "/v1/configurations/" + configId
      })
        .then(r => r.json())
        .then(configuration => {
          return { configuration };
        })
        .catch(() => {
          console.error("Could not fetch confiugration");
        });
    },

    components: { ConfigEditor },

    methods: {
      editConfig(newConfig) {
        AjaxService.put({
          url: "/v1/configurations/" + newConfig.id,
          data: {
            configuration: JSON.stringify(newConfig)
          }
        }).then(() => {
          this.root.fire("alert-notification", {
            header: "Sucess",
            message: "Sucessed created new configuration"
          });
          sapper.goto("/");
        });
      }
    }
  };
</script>
